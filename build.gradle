/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'NineKFlames' at '20.12.15 20:23' with Gradle 2.9
 *
 */

plugins {
  id "com.ullink.msbuild" version "2.11"
}

String deploymentDirPath = 'bin/deployment'
String leapDllsX64Dir = "$System.env.LEAP_SDK\\lib\\x64\\"

task copyLeapDlls {
	copy {
		from file(leapDllsX64Dir + "Leap.dll")
		from file(leapDllsX64Dir + "LeapCSharp.dll")
		into file(deploymentDirPath)
	}
}

/* TODO: uncomment when added to git repo
task updateProjectVersionFromGit {
	exec {
		commandLine 'git', 'describe'
	}
	
	project.version = logging.captureStandardOutput(LogLevel.INFO)
}*/

apply plugin:'msbuild'

msbuild {
	solutionFile = 'MimeArm.sln'
	projectFile = file('MimeArm/MimeArm.csproj')
	
	// targets to execute (/t:Clean;Rebuild, no default)
	targets = ['Clean', 'Rebuild']
	
	// overrides project OutputPath
	destinationDir = deploymentDirPath
	
	// copy Leap Motion dll files needed for launch
	copyLeapDlls
	
	// cleanup
	delete {
		file '.gradle'
	}
}

assemblyInfoPatcher {
	version = project.version + '.0.0'
	
	// defaults to above version, fewer restrictions on the format
	fileVersion = version + '-Beta'
	
	// default to msbuild main project (of solution)
	projects = [ 'MimeArm' ]
}
