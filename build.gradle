/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'NineKFlames' at '20.11.15 20:23' with Gradle 2.9
 *
 */

plugins {
  id "com.ullink.msbuild" version "2.11"
}

String deploymentDirPath = 'bin/deployment'
String leapDllsX64Dir = "$System.env.LEAP_SDK\\lib\\x64\\"

task getVersion {
    def stdout = new ByteArrayOutputStream()
    exec {
        commandLine 'git', 'describe'
        standardOutput = stdout
    }
    String version = stdout.toString().trim()
	File assemblyInfoFile = file('MimeArm/Properties/AssemblyInfo.cs')
	
	filter { File text -> replace ('')}
}

task copyLeapDlls {
	copy {
		from file(leapDllsX64Dir + "Leap.dll")
		from file(leapDllsX64Dir + "LeapCSharp.dll")
		into file(deploymentDirPath)
	}
}

//task updateProjectVersionFromGit {
//	String projectVersion
//
//	exec {
//		commandLine 'git', 'describe'
//		projectVersion = logging.captureStandardOutput
//	}
//	
//	println "git tag extracted: " + projectVersion
//	//
//}

apply plugin:'msbuild'

msbuild {
	solutionFile = 'MimeArm.sln'
	projectFile = file('MimeArm/MimeArm.csproj')
	
	// targets to execute (/t:Clean;Rebuild, no default)
	targets = ['Clean', 'Rebuild']
	
	// overrides project OutputPath
	destinationDir = deploymentDirPath
	
	// copy Leap Motion dll files needed for launch
	copyLeapDlls
}

assemblyInfoPatcher {
	version = project.version + '.0.0'
	
	// defaults to above version, fewer restrictions on the format
	fileVersion = version + '-Beta'
	
	// default to msbuild main project (of solution)
	projects = [ 'MimeArm' ]
}
